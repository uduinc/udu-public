exports = module.exports = {
	id : 'com.slack.send_message',
	input : [ 'slack_message', 'slack_web_hook' ],
	output : [ 'slack_message_sent' ],
	input_optional : [ 'slack_channel_name' ],
	output_optional : [],
	meta : {
		tags : [ 'communication', 'Slack' ],
		author : 'drew',
		reference : 'https://www.npmjs.com/package/slack-node',
		documentation: {
			slack_message: {
				description: 'Message to send to Slack',
				type: 'string'
			},
			slack_web_hook: {
				description: 'webhook url generated by Slack',
				type: 'string'
			},
			slack_channel_name: {
				description: 'Channel name to send a Slack message to',
				type: 'string'
			},
			slack_message_sent: {
				description: 'Whether or not a Slack message was successfully sent',
				type: 'boolean'
			}
		}
	},
	do_not_cache : true,
	init : function ( ) {
		this.Slack = this.require( 'slack-node' );
	},
	process : function ( req )
	{
		var self = this;

		var slack = new self.Slack( );
		slack.setWebhook( req.slack_web_hook );

		var config = {
			username : 'udubot',
			icon_emoji: ":squirrel:",
			text : req.slack_message
		};

		if ( req.slack_channel_name )
		{
			config.channel = req.slack_channel_name;
		}
		 
		slack.webhook( config, function ( err, response ) {
			if ( err )
			{
				console.error( 'Failure to send Slack message', err, config );
				self.fail( );
			} else {
				self.mutate( { slack_message_sent : true } );
			}
		});
	}
}